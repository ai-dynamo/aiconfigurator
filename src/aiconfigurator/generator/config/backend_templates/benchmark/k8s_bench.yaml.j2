apiVersion: batch/v1
kind: Job
metadata:
  name: {{ bench_job_name }}
  namespace: {{ k8s_namespace | default("default") }}
spec:
  backoffLimit: 0
  template:
    metadata:
      name: {{ bench_job_name }}
    spec:
      restartPolicy: Never
      containers:
        - name: aiperf
          image: {{ bench_image }}
          env:
            - name: AIPERF_SERVICE_PROFILE_START_TIMEOUT
              value: "{{ bench_profile_start_timeout }}"
          command: ["/bin/bash", "-c"]
          args:
            - |
              pip install aiperf
              aiperf profile \
                -m {{ (bench_model.split('/')[-1] if bench_model else '') }} \
                --endpoint-type {{ bench_endpoint_type }} \
                -u {{ bench_endpoint_url }} \
                --tokenizer {{ bench_tokenizer }} \
                --isl {{ bench_isl }} --isl-stddev {{ bench_isl_stddev }} \
                --osl {{ bench_osl }} --osl-stddev {{ bench_osl_stddev }} \
                --num-requests {{ bench_num_requests | join(' ') }} \
                --concurrency {{ bench_concurrency | join(' ') }} \
                --ui {{ bench_ui }} \
                --streaming
